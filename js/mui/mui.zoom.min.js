!function(o,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(o.mui,o):"function"==typeof define&&(define.amd||define.cmd)?define(function(e){var n=e("mui");t(n,o)}):t(o.mui,o)}(this,function(o,t){var e=o.className("zoom"),n=o.className("zoom-scroller"),r="."+e,a="."+n,i="pinchstart",s="pinch",m="pinchend";"ongesturestart"in t&&(i="gesturestart",s="gesturechange",m="gestureend"),o.Zoom=function(t,e){var n=this;n.options=o.extend(o.Zoom.defaults,e),n.wrapper=n.element=t,n.scroller=t.querySelector(a),n.scrollerStyle=n.scroller&&n.scroller.style,n.zoomer=t.querySelector(r),n.zoomerStyle=n.zoomer&&n.zoomer.style,n.init=function(){o.options.gestureConfig.pinch=!0,o.options.gestureConfig.doubletap=!0,n.initEvents()},n.initEvents=function(t){var e=t?"removeEventListener":"addEventListener",r=n.scroller;r[e](i,n.onPinchstart),r[e](s,n.onPinch),r[e](m,n.onPinchend),r[e](o.EVENT_START,n.onTouchstart),r[e](o.EVENT_MOVE,n.onTouchMove),r[e](o.EVENT_CANCEL,n.onTouchEnd),r[e](o.EVENT_END,n.onTouchEnd),r[e]("drag",n.dragEvent),r[e]("doubletap",n.doubleTapEvent)},n.dragEvent=function(o){(T||u)&&o.stopPropagation()},n.doubleTapEvent=function(o){n.toggleZoom(o.detail.center)},n.transition=function(o,t){return t=t||0,o.webkitTransitionDuration=t+"ms",n},n.translate=function(o,t,e){return t=t||0,e=e||0,o.webkitTransform="translate3d("+t+"px,"+e+"px,0px)",n},n.scale=function(o,t){return t=t||1,o.webkitTransform="translate3d(0,0,0) scale("+t+")",n},n.scrollerTransition=function(o){return n.transition(n.scrollerStyle,o)},n.scrollerTransform=function(o,t){return n.translate(n.scrollerStyle,o,t)},n.zoomerTransition=function(o){return n.transition(n.zoomerStyle,o)},n.zoomerTransform=function(o){return n.scale(n.zoomerStyle,o)};var l=1,f=1,c=!1,u=!1;n.onPinchstart=function(o){u=!0},n.onPinch=function(o){c||(n.zoomerTransition(0),c=!0),l=(o.detail?o.detail.scale:o.scale)*f,l>n.options.maxZoom&&(l=n.options.maxZoom-1+Math.pow(l-n.options.maxZoom+1,.5)),l<n.options.minZoom&&(l=n.options.minZoom+1-Math.pow(n.options.minZoom-l+1,.5)),n.zoomerTransform(l)},n.onPinchend=function(o){l=Math.max(Math.min(l,n.options.maxZoom),n.options.minZoom),n.zoomerTransition(n.options.speed).zoomerTransform(l),f=l,c=!1},n.setZoom=function(o){l=f=o,n.scrollerTransition(n.options.speed).scrollerTransform(0,0),n.zoomerTransition(n.options.speed).zoomerTransform(l)},n.toggleZoom=function(t,e){if("number"==typeof t&&(e=t,t=void 0),e="undefined"==typeof e?n.options.speed:e,l&&1!==l)l=f=1,n.scrollerTransition(e).scrollerTransform(0,0);else if(l=f=n.options.maxZoom,t){var r=o.offset(n.zoomer),a=r.top,i=r.left,s=(t.x-i)*l,m=(t.y-a)*l;this._cal(),s>=v&&v+p>=s?s=v-s+p/2:v>s?s=v-s+p/2:s>v+p&&(s=v+p-s-p/2),m>=y&&y+h>=m?m=y-m+h/2:y>m?m=y-m+h/2:m>y+h&&(m=y+h-m-h/2),s=Math.min(Math.max(s,x),v),m=Math.min(Math.max(m,E),y),n.scrollerTransition(e).scrollerTransform(s,m)}else n.scrollerTransition(e).scrollerTransform(0,0);n.zoomerTransition(e).zoomerTransform(l)},n._cal=function(){p=n.wrapper.offsetWidth,h=n.wrapper.offsetHeight,z=n.zoomer.offsetWidth,w=n.zoomer.offsetHeight;var o=z*l,t=w*l;x=Math.min(p/2-o/2,0),v=-x,E=Math.min(h/2-t/2,0),y=-E};var p,h,d,T,g,M,x,E,v,y,z,w,b,Z,N,S,V,_,A,P={},k={};return n.onTouchstart=function(t){t.preventDefault(),d=!0,P.x=t.type===o.EVENT_START?t.targetTouches[0].pageX:t.pageX,P.y=t.type===o.EVENT_START?t.targetTouches[0].pageY:t.pageY},n.onTouchMove=function(t){if(t.preventDefault(),d){if(!T){p=n.wrapper.offsetWidth,h=n.wrapper.offsetHeight,z=n.zoomer.offsetWidth,w=n.zoomer.offsetHeight;var e=o.parseTranslateMatrix(o.getStyles(n.scroller,"webkitTransform"));b=e.x||0,Z=e.y||0,n.scrollerTransition(0)}var r=z*l,a=w*l;if(!(p>r&&h>a)){if(x=Math.min(p/2-r/2,0),v=-x,E=Math.min(h/2-a/2,0),y=-E,k.x=t.type===o.EVENT_MOVE?t.targetTouches[0].pageX:t.pageX,k.y=t.type===o.EVENT_MOVE?t.targetTouches[0].pageY:t.pageY,!T&&!c&&(Math.floor(x)===Math.floor(b)&&k.x<P.x||Math.floor(v)===Math.floor(b)&&k.x>P.x))return void(d=!1);T=!0,g=k.x-P.x+b,M=k.y-P.y+Z,x>g&&(g=x+1-Math.pow(x-g+1,.8)),g>v&&(g=v-1+Math.pow(g-v+1,.8)),E>M&&(M=E+1-Math.pow(E-M+1,.8)),M>y&&(M=y-1+Math.pow(M-y+1,.8)),N||(N=k.x),_||(_=k.y),S||(S=o.now()),V=(k.x-N)/(o.now()-S)/2,A=(k.y-_)/(o.now()-S)/2,Math.abs(k.x-N)<2&&(V=0),Math.abs(k.y-_)<2&&(A=0),N=k.x,_=k.y,S=o.now(),n.scrollerTransform(g,M)}}},n.onTouchEnd=function(o){if(o.touches.length||(u=!1),!d||!T)return d=!1,void(T=!1);d=!1,T=!1;var t=300,e=300,r=V*t,a=g+r,i=A*e,s=M+i;0!==V&&(t=Math.abs((a-g)/V)),0!==A&&(e=Math.abs((s-M)/A));var m=Math.max(t,e);g=a,M=s;var f=z*l,c=w*l;x=Math.min(p/2-f/2,0),v=-x,E=Math.min(h/2-c/2,0),y=-E,g=Math.max(Math.min(g,v),x),M=Math.max(Math.min(M,y),E),n.scrollerTransition(m).scrollerTransform(g,M)},n.destroy=function(){n.initEvents(!0),delete o.data[n.wrapper.getAttribute("data-zoomer")],n.wrapper.setAttribute("data-zoomer","")},n.init(),n},o.Zoom.defaults={speed:300,maxZoom:3,minZoom:1},o.fn.zoom=function(t){var e=[];return this.each(function(){var n=null,r=this,a=r.getAttribute("data-zoomer");a?n=o.data[a]:(a=++o.uuid,o.data[a]=n=new o.Zoom(r,t),r.setAttribute("data-zoomer",a)),e.push(n)}),1===e.length?e[0]:e}});