!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(t.mui,t):"function"==typeof define&&(define.amd||define.cmd)?define(function(a){var s=a("mui");e(s,t)}):e(t.mui,t)}(this,function(t,e){var a=t.className("left"),s=t.className("center"),i=t.className("right"),r=t.className("page"),n=t.className("page-left"),o=t.className("page-center"),h=t.className("navbar-left"),c=t.className("navbar-center"),v=t.className("page-shadow"),l=t.className("transitioning"),g="."+a,u="."+s,p="."+i,d=t.classSelector(".icon"),f=t.classSelector(".navbar"),m=t.classSelector(".navbar-inner"),b=t.classSelector(".pages"),N=t.classSelector(".btn-nav"),y="."+n,_="."+o,P="."+h,S="."+c,L=t.Class.extend({init:function(e,a){this.view=this.element=e,this.options=t.extend({animateNavbar:"ios",swipeBackPageActiveArea:30,hardwareAccelerated:!0},a),this.navbars=this.view.querySelector(f),this.pages=this.view.querySelector(b),this.history=[],this.maxScrollX=this.view.offsetWidth,this.x=this.y=0,this.translateZ=this.options.hardwareAccelerated?" translateZ(0)":"",this.ratio=0,this.isBack=!0,this.moved=this.dragging=!1,this.activeNavbar=this.previousNavbar=null,this.activePage=this.previousPage=null,this._initPageEventMethod(),this._initDefaultPage(),this.navbars&&this._initNavBar(),this.initEvent()},_initPageEventMethod:function(){var e=this;t.each(["onPageBeforeShow","onPageShow","onPageBeforeBack","onPageBack"],function(t,a){e[a+"Callbacks"]={},e[a]=function(t,s){var i=a+"Callbacks";e[i].hasOwnProperty(t)?e[i][t].push(s):e[i][t]=[s]}})},_initDefaultPage:function(){var t=document.querySelector(this.options.defaultPage);if(!t)throw new Error("defaultPage["+this.options.defaultPage+"] does not exist");this._appendPage(t)},initEvent:function(){this.view.addEventListener("click",this),this.view.addEventListener("tap",this),this.pages.addEventListener("drag",this),this.pages.addEventListener("dragend",this),this.pages.addEventListener("webkitTransitionEnd",this)},handleEvent:function(t){switch(t.type){case"click":this._click(t);break;case"tap":this._tap(t);break;case"drag":this._drag(t);break;case"dragend":this._dragend(t);break;case"webkitTransitionEnd":this._webkitTransitionEnd(t)}},shadow:function(){var t=document.createElement("div");return t.className=v,t}(),_removePage:function(t,e){e&&this._removeNavbar(t,e),document.body.appendChild(t),this._cleanPageClass(t)},_prependPage:function(t){var e=t.querySelector(m);e&&this._prependNavbar(e),t.classList.add(n),this.pages.insertBefore(t,this.pages.firstElementChild)},_appendPage:function(t){var e=t.querySelector(m);e&&this._appendNavbar(e),t.classList.add(o),this.pages.appendChild(t)},_removeNavbar:function(t,e){t.insertBefore(e,t.firstElementChild),this._cleanNavbarClass(e)},_prependNavbar:function(t){t.classList.add(h),this.navbars.insertBefore(t,this.navbars.firstElementChild)},_appendNavbar:function(t){t.classList.add(c),this.navbars.appendChild(t)},_cleanPageClass:function(t){t.classList.remove(o),t.classList.remove(n)},_cleanNavbarClass:function(t){t.classList.remove(c),t.classList.remove(h)},_tap:function(t){for(var e=t.target;e&&e!==document;e=e.parentNode)if("A"===e.tagName&&e.hash){var a=document.getElementById(e.hash.replace("#",""));if(a&&a.classList.contains(r)){t.stopPropagation(),t.detail.gesture.preventDefault(),this.go(e.hash);break}}},_click:function(t){for(var e=t.target;e&&e!==document;e=e.parentNode)if("A"===e.tagName&&e.hash){var a=document.getElementById(e.hash.replace("#",""));if(a&&a.classList.contains(r)){t.preventDefault();break}}},_cleanStyle:function(t){t&&(t.style.webkitTransform="",t.style.opacity="")},_isAnimateNavbarIOS:function(){return!t.os.android&&"ios"===this.options.animateNavbar},_webkitTransitionEnd:function(e){if(this.dragging=this.moved=!1,this.activePage===e.target){this.isInTransition=!1,this.shadow.parentNode===this.activePage&&this.activePage.removeChild(this.shadow),this.previousPageClassList.remove(l),this.activePageClassList.remove(l);var a=this;if(this._isAnimateNavbarIOS()&&this.previousNavElements&&this.activeNavElements){var s=this.isBack;t.each(this.previousNavElements,function(t,e){e.classList.remove(l),s&&a._cleanStyle(e)}),t.each(this.activeNavElements,function(t,e){e.classList.remove(l),a._cleanStyle(e)}),this.previousNavBackIcon&&(this.previousNavBackIcon.classList.remove(l),s&&this._cleanStyle(this.previousNavBackIcon)),this.activeNavBackIcon&&(this.activeNavBackIcon.classList.remove(l),this._cleanStyle(this.activeNavBackIcon))}else this.previousNavbar&&this.previousNavbar.classList.remove(l),this.activeNavbar&&this.activeNavbar.classList.remove(l),this._cleanStyle(this.previousNavbar),this._cleanStyle(this.activeNavbar);this._cleanStyle(this.previousPage),this._cleanStyle(this.activePage),this.ratio<=.5||(this.isBack?(this._removePage(this.activePage,this.activeNavbar),this.previousPageClassList.remove(n),this.previousPageClassList.add(o),this.previousNavbar&&(this.previousNavbar.classList.remove(h),this.previousNavbar.classList.add(c)),this.history.length>0&&this._prependPage(this.history.pop()),this.navbars&&this._initNavBar(),this._trigger("pageBack",this.activePage),this._trigger("pageShow",this.previousPage)):(this.previousPageClassList.add(n),this.activePageClassList.add(o),this._trigger("pageShow",this.activePage)))}},_trigger:function(e,a){var s="on"+e.charAt(0).toUpperCase()+e.slice(1)+"Callbacks";if(this[s].hasOwnProperty(a.id))for(var i=this[s][a.id],r=new CustomEvent(e,{detail:{page:a},bubbles:!0,cancelable:!0}),n=i.length;n--;)i[n].call(this,r);t.trigger(this.view,e,{page:a})},_initPageTransform:function(){return this.previousPage=this.pages.querySelector(y),this.activePage=this.pages.querySelector(_),this.previousPage&&this.activePage?(this.activePage.appendChild(this.shadow),this.previousPageClassList=this.previousPage.classList,this.activePageClassList=this.activePage.classList,this.previousPageStyle=this.previousPage.style,this.activePageStyle=this.activePage.style,this.previousPageClassList.remove(l),this.activePageClassList.remove(l),this.navbars&&(this.previousNavbar=this.navbars.querySelector(P),this.activeNavbar=this.navbars.querySelector(S),this._isAnimateNavbarIOS()&&this.previousNavbar&&this.activeNavbar&&(this.previousNavElements=this.previousNavbar.querySelectorAll(g+","+u+","+p),this.activeNavElements=this.activeNavbar.querySelectorAll(g+","+u+","+p),this.previousNavBackIcon=this.previousNavbar.querySelector(g+N+" "+d),this.activeNavBackIcon=this.activeNavbar.querySelector(g+N+" "+d))),this.x=0,this.dragging=!0,!0):!1},_initNavBar:function(){if(this._isAnimateNavbarIOS()&&this.navbars)for(var t,e,a,s,i,r,n,o,h,c,v,l=this.navbars.querySelectorAll(m),d=0,f=l.length;f>d;d++){t=l[d],e=t.querySelector(g),a=t.querySelector(p),s=t.querySelector(u),o=!e,noRight=!a,i=o?0:e.offsetWidth,r=noRight?0:a.offsetWidth,n=s?s.offsetWidth:0,v=this.maxScrollX,onLeft=t.classList.contains("navbar-left"),noRight&&(h=v-n),o&&(h=0),o||noRight||(h=(v-r-n+i)/2);var b=(v-n)/2;v-i-r>n?(i>b&&(b=i),b+n>v-r&&(b=v-r-n),c=b-h):c=0;s&&(s.style.marginLeft=-i+"px",s.mNavbarLeftOffset=-(h+c)+30,s.mNavbarRightOffset=v-h-c-n),onLeft&&(s.style.webkitTransform="translate3d("+s.mNavbarLeftOffset+"px, 0, 0)"),o||(e.mNavbarLeftOffset=-i,e.mNavbarRightOffset=(v-i)/2,onLeft&&(e.style.webkitTransform="translate3d("+e[0].mNavbarLeftOffset+"px, 0, 0)")),noRight||(a.mNavbarLeftOffset=-(v-r)/2,a.mNavbarRightOffset=r,onLeft&&(a.style.webkitTransform="translate3d("+a[0].mNavbarLeftOffset+"px, 0, 0)"))}},_drag:function(e){if(!this.isInTransition){var a=e.detail;if(this.dragging||t.gestures.session.firstTouch.center.x-this.view.offsetLeft<this.options.swipeBackPageActiveArea&&(this.isBack=!0,this._initPageTransform()),this.dragging){var s=0;this.moved?s=a.deltaX-(t.gestures.session.prevTouch&&t.gestures.session.prevTouch.deltaX||0):(s=a.deltaX,t.gestures.session.lockDirection=!0,t.gestures.session.startDirection=a.direction);var i=this.x+s;(0>i||i>this.maxScrollX)&&(i=0>i?0:this.maxScrollX),e.stopPropagation(),a.gesture.preventDefault(),this.requestAnimationFrame||this._updateTranslate(),this.moved=!0,this.x=i,this.y=0}}},_dragend:function(e){if(this.moved){e.stopPropagation();e.detail;return this._clearRequestAnimationFrame(),this._prepareTransition(),this.ratio=this.x/this.maxScrollX,1===this.ratio||0===this.ratio?void t.trigger(this.activePage,"webkitTransitionEnd"):void(this.ratio>.5?this.setTranslate(this.maxScrollX,0):(this._cleanStyle(this.previousPage),this._cleanStyle(this.activePage)))}},_prepareTransition:function(){this.isInTransition=!0,this.previousPageClassList.add(l),this.activePageClassList.add(l);var e=this;this.previousNavbar&&this.activeNavbar&&(this.previousNavbar.classList.add(l),this.activeNavbar.classList.add(l),this._isAnimateNavbarIOS()&&this.previousNavElements&&this.activeNavElements&&(t.each(this.previousNavElements,function(t,a){a.classList.add(l),e._cleanStyle(a)}),t.each(this.activeNavElements,function(t,a){a.classList.add(l),e._cleanStyle(a)}),this.previousNavBackIcon&&(this._cleanStyle(this.previousNavBackIcon),this.previousNavBackIcon.classList.add(l)),this.activeNavBackIcon&&(this._cleanStyle(this.activeNavBackIcon),this.activeNavBackIcon.classList.add(l))))},_clearRequestAnimationFrame:function(){this.requestAnimationFrame&&(cancelAnimationFrame(this.requestAnimationFrame),this.requestAnimationFrame=null)},_getTranslateStr:function(t,e){return this.options.hardwareAccelerated?"translate3d("+t+"px,"+e+"px,0px) "+this.translateZ:"translate("+t+"px,"+e+"px) "},_updateTranslate:function(){var t=this;t.x===t.lastX&&t.y===t.lastY||t.setTranslate(t.x,t.y),t.requestAnimationFrame=requestAnimationFrame(function(){t._updateTranslate()})},_setNavbarTranslate:function(t,e){var a=t/this.maxScrollX;this._isAnimateNavbarIOS()?this.previousNavElements&&this.activeNavElements&&this.animateNavbarByIOS(a):(this.activeNavbar.style.opacity=1-1.3*a,this.previousNavbar.style.opacity=1.3*a-.3)},animateNavbarByIOS:function(t){var e,s,r,n;for(e=0,s=this.activeNavElements.length;s>e;e++)if(n=this.activeNavElements[e],r=n.style,r.opacity=1-t*(n.classList.contains(a)?3.5:1.3),!n.classList.contains(i)){var o=t*n.mNavbarRightOffset;n.style.webkitTransform="translate3d("+o+"px,0,0)",n.classList.contains(a)&&this.activeNavBackIcon&&(this.activeNavBackIcon.style.webkitTransform="translate3d("+-o+"px,0,0)")}for(e=0,s=this.previousNavElements.length;s>e;e++)if(n=this.previousNavElements[e],r=n.style,r.opacity=1.3*t-.3,!n.classList.contains(i)){var h=n.mNavbarLeftOffset*(1-t);n.style.webkitTransform="translate3d("+h+"px,0,0)",n.classList.contains(a)&&this.previousNavBackIcon&&(this.previousNavBackIcon.style.webkitTransform="translate3d("+-h+"px,0,0)")}},setTranslate:function(t,e){this.x=t,this.y=e,this.previousPage.style.opacity=.9+.1*t/this.maxScrollX,this.previousPage.style.webkitTransform=this._getTranslateStr(t/6-this.maxScrollX/6,e),this.activePage.style.webkitTransform=this._getTranslateStr(t,e),this.navbars&&this._setNavbarTranslate(t,e),this.lastX=this.x,this.lastY=this.y},canBack:function(){return this.pages.querySelector(y)},back:function(){this.isInTransition||(this.isBack=!0,this.ratio=1,this._initPageTransform()&&(this._trigger("pageBeforeBack",this.activePage),this._trigger("pageBeforeShow",this.previousPage),this._prepareTransition(),this.previousPage.offsetHeight,this.activePage.offsetHeight,this.setTranslate(this.maxScrollX,0)))},go:function(t){if(!this.isInTransition){var e=document.querySelector(t);if(e){var a,s,i=this.pages.querySelector(y),r=this.pages.querySelector(_);this.navbars&&(a=this.navbars.querySelector(P),s=this.navbars.querySelector(S)),s&&(s.classList.remove(c),s.classList.add(h)),i&&(this._removePage(i,a),this.history.push(i)),r&&(r.classList.remove(o),r.style.webkitTransform="translate3d(0,0,0)",r.classList.add(n)),e.style.webkitTransform="translate3d(100%,0,0)",this._appendPage(e),e.appendChild(this.shadow),e.offsetHeight,this.isBack=!1,this.ratio=1,this._initPageTransform(),this.navbars&&this._initNavBar(),this.navbars&&this._setNavbarTranslate(this.maxScrollX,0),this.previousPage.offsetHeight,this.activePage.offsetHeight,this.navbars&&(this.previousNavbar.offsetHeight,this.activeNavbar.offsetHeight),this._trigger("pageBeforeShow",this.activePage),this._prepareTransition(),this.setTranslate(0,0)}}}});t.fn.view=function(e){var a=this[0],s=null,i=a.getAttribute("data-view");return i?s=t.data[i]:(i=++t.uuid,t.data[i]=s=new L(a,e),a.setAttribute("data-view",i)),s}});